version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install -g pnpm
        - pnpm install
        - cd packages/server && pnpm prisma generate
    build:
      commands:
        - cd packages/frontend && pnpm run build
  artifacts:
    baseDirectory: packages/frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - packages/frontend/node_modules/**/*
      - packages/server/node_modules/**/*
backend:
  phases:
    preBuild:
      commands:
        - npm install -g pnpm
        - pnpm install
        - cd packages/server && pnpm prisma generate
    build:
      commands:
        - cd packages/server && pnpm run build
    postBuild:
      commands:
        - cd packages/server && pnpm prisma migrate deploy
  artifacts:
    baseDirectory: packages/server
    files:
      - dist/**/*
      - package.json
      - node_modules/**/*
      - generated/**/*
